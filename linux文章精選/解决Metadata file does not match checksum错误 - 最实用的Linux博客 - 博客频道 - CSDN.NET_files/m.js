(function(window,document){window._amButtonPageTransition=function(callback,sourceNew,$){if(sourceNew){sourceNew=sourceNew.replace(/<head>/,'<head><style id="am-at-animation">@-webkit-keyframes moveFromLeft {from {-webkit-transform:translateX(-100%);transform:translateX(-100%);} to {}} @keyframes moveFromLeft {from {-webkit-transform:translateX(-100%);transform:translateX(-100%);} to {}}html{transform-style:preserve-3d;perspective:1200px;-webkit-animation:moveFromLeft 0.5s ease both;}</style>');var pattern=/(<script>(\s)*seajs.use\(\[([^\]]+)\])(\);(\s)*<\/script>)/;var result=sourceNew.match(pattern);if(result){function refineWidgetString(widgetRawString){var temp=widgetRawString.trim();return temp.substring(1,temp.length-1)}var appendedParams="";var appendedBody="";var appendedContent="";var widgetsRawString=result[3];var widgetRawArray=widgetsRawString.split(",");var widgetString;for(var i=0;i<widgetRawArray.length;i++){widgetString=refineWidgetString(widgetRawArray[i]);if(i===widgetRawArray.length-1){appendedParams+=widgetString;if(widgetString!=="header"&&widgetString!=="titlebar"){appendedBody+=widgetString+".init();"}}else{appendedParams+=widgetString+", ";if(widgetString!=="header"&&widgetString!=="titlebar"){appendedBody+=widgetString+".init(); "}}}appendedContent=", function("+appendedParams+") { "+appendedBody+" }";sourceNew=sourceNew.replace(pattern,"$1"+appendedContent+"$4")}document.open("text/html","replace");document.write(sourceNew);document.close();var $root=$(document.documentElement);$root.on("ready",function(){setTimeout(function(){$root.find("#am-at-animation").remove()},2e3)});callback(true)}else{callback(false)}};window._amButton=function($,lang,isDesktopMode,clickCB){(function($){var touch={},touchTimeout,tapTimeout,swipeTimeout,longTapTimeout,longTapDelay=750,gesture;function swipeDirection(x1,x2,y1,y2){return Math.abs(x1-x2)>=Math.abs(y1-y2)?x1-x2>0?"Left":"Right":y1-y2>0?"Up":"Down"}function longTap(){longTapTimeout=null;if(touch.last){touch.el.trigger("longTap");touch={}}}function cancelLongTap(){if(longTapTimeout)clearTimeout(longTapTimeout);longTapTimeout=null}function cancelAll(){if(touchTimeout)clearTimeout(touchTimeout);if(tapTimeout)clearTimeout(tapTimeout);if(swipeTimeout)clearTimeout(swipeTimeout);if(longTapTimeout)clearTimeout(longTapTimeout);touchTimeout=tapTimeout=swipeTimeout=longTapTimeout=null;touch={}}function isPrimaryTouch(event){return(event.pointerType=="touch"||event.pointerType==event.MSPOINTER_TYPE_TOUCH)&&event.isPrimary}function isPointerEventType(e,type){return e.type=="pointer"+type||e.type.toLowerCase()=="mspointer"+type}$(document).ready(function(){var now,delta,deltaX=0,deltaY=0,firstTouch,_isPointerType;if("MSGesture"in window){gesture=new MSGesture;gesture.target=document.body}$(document).bind("MSGestureEnd",function(e){var swipeDirectionFromVelocity=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;if(swipeDirectionFromVelocity){touch.el.trigger("swipe");touch.el.trigger("swipe"+swipeDirectionFromVelocity)}}).on("touchstart MSPointerDown pointerdown",function(e){if((_isPointerType=isPointerEventType(e,"down"))&&!isPrimaryTouch(e))return;firstTouch=_isPointerType?e:e.touches[0];if(e.touches&&e.touches.length===1&&touch.x2){touch.x2=undefined;touch.y2=undefined}now=Date.now();delta=now-(touch.last||now);touch.el=$("tagName"in firstTouch.target?firstTouch.target:firstTouch.target.parentNode);touchTimeout&&clearTimeout(touchTimeout);touch.x1=firstTouch.pageX;touch.y1=firstTouch.pageY;if(delta>0&&delta<=250)touch.isDoubleTap=true;touch.last=now;longTapTimeout=setTimeout(longTap,longTapDelay);if(gesture&&_isPointerType)gesture.addPointer(e.pointerId)}).on("touchmove MSPointerMove pointermove",function(e){if((_isPointerType=isPointerEventType(e,"move"))&&!isPrimaryTouch(e))return;firstTouch=_isPointerType?e:e.touches[0];cancelLongTap();touch.x2=firstTouch.pageX;touch.y2=firstTouch.pageY;deltaX+=Math.abs(touch.x1-touch.x2);deltaY+=Math.abs(touch.y1-touch.y2)}).on("touchend MSPointerUp pointerup",function(e){if((_isPointerType=isPointerEventType(e,"up"))&&!isPrimaryTouch(e))return;cancelLongTap();if(touch.x2&&Math.abs(touch.x1-touch.x2)>30||touch.y2&&Math.abs(touch.y1-touch.y2)>30)swipeTimeout=setTimeout(function(){touch.el.trigger("swipe");touch.el.trigger("swipe"+swipeDirection(touch.x1,touch.x2,touch.y1,touch.y2));touch={}},0);else if("last"in touch)if(deltaX<30&&deltaY<30){tapTimeout=setTimeout(function(){var event=$.Event("tap");event.cancelTouch=cancelAll;touch.el.trigger(event);if(touch.isDoubleTap){if(touch.el)touch.el.trigger("doubleTap");touch={}}else{touchTimeout=setTimeout(function(){touchTimeout=null;if(touch.el)touch.el.trigger("singleTap");touch={}},250)}},0)}else{touch={}}deltaX=deltaY=0}).on("touchcancel MSPointerCancel pointercancel",cancelAll);$(window).on("scroll",cancelAll)});["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(eventName){$.fn[eventName]=function(callback){return this.on(eventName,callback)}})})($);if(isDesktopMode){var BTN_URL="http://s.yunshipei.com/at/button-blue.png";var BTN_MOBILE_SRC="http://s.yunshipei.com/at/mobile.png";var BTN_MOBILE_BG_SRC="http://s.yunshipei.com/at/mobile_bg.png";var BTN_WIDTH=70;var BTN_HEIGHT=70;var FLIP_TRANSITION="2s";var FLIP_TRANSITION_VALUE_IN_MILL=2e3;var FLIP_TRANSITION_MOBILE="1s";var PERSPECTIVE="1000";var MOBILE_HEIGHT_RATIO=.74;var MOBILE_WIDTH_RATIO=.46;var initWidth=$(window).width();var initHeight=$(window).height();var deviceWidth=screen.width*window.devicePixelRatio;var deviceWidth=screen.width;var buttonWidth=BTN_WIDTH;var initButtonWidth=initWidth/(deviceWidth/buttonWidth);var initButtonHeight=initButtonWidth/BTN_WIDTH*BTN_HEIGHT;var $html=$("html"),$body=$("body");var $img=$('<img src="http://s.yunshipei.com/at/am-mobile-btn.png" />');var btnModHtml='<div class="am-mobilize-btn" id="am-mobilize-btn">';btnModHtml+='<div class="am-mobilize-btn-inner" id="am-mobile-btn-inner">';btnModHtml+='<div id="am-btn-icon-red"></div>'+'<div id="am-btn-icon-blue"></div>'+'<div id="am-btn-icon-green"></div>';btnModHtml+="</div>";btnModHtml+="</div>";var $amButton=$(btnModHtml),$amButtonBox=$amButton.find("#am-mobile-btn-inner");$amIconRed=$amButtonBox.find("#am-btn-icon-red"),$amIconBlue=$amButtonBox.find("#am-btn-icon-blue"),$amIconGreen=$amButtonBox.find("#am-btn-icon-green");if($(".am-mobilize-btn").length<=0){$body.prepend($amButton)}$amButton.css({width:initButtonWidth,height:initButtonHeight,"border-radius":"10px","background-color":"#dbdcdc"});$amButtonBox.css({position:"absolute",overflow:"hidden",width:"52%",height:"52%",left:"50%",top:"50%","margin-top":"-26%","margin-left":"-26%"});$amIconRed.add($amIconBlue).add($amIconGreen).css({position:"absolute"});$amIconRed.css({left:0,top:0,width:"45%",height:"100%","background-color":"#ea5433"});$amIconBlue.css({right:0,top:0,width:"45%",height:"60%","background-color":"#2ea3dc",visibility:"hidden"});$amIconGreen.css({right:0,bottom:0,width:"45%",height:"30%","background-color":"#6dba44",visibility:"hidden"})+function(){function rotateMod(ele,data){var data=data||{};var end=data.end||180;var delay=data.delay||0;var duration=data.duration||1;var timer,timer_delay;var n=0;clearTimeout(timer_delay);if(delay){timer_delay=setTimeout(function(){rotate();$(ele).css({visibility:"visible"})},delay*1e3)}else{rotate()}function rotate(){clearTimeout(timer);timer=setInterval(function(){if(n>=end){n=end;clearInterval(timer)}else{n+=end/60/duration}$(ele).css({transform:"rotate("+n+"deg)","-webkit-transform":"rotate("+n+"deg)","-o-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)","-moz-transform":"rotate("+n+"deg)"})},1e3/60)}}rotateMod("#am-btn-icon-red",{duration:2});rotateMod("#am-btn-icon-blue",{duration:1,delay:1});rotateMod("#am-btn-icon-green",{duration:1,delay:1});setTimeout(function(){$amButton.css({background:"url(http://s.yunshipei.com/at/am-mobile-btn.png) no-repeat center","background-size":"100%"});$amButtonBox.remove()},2500)}();$amButton.bind("touchstart",function(){$amButton.remove();clickCB();return false});var watch_timer=null;var storage=0;$(window).on("scroll",function(){$amButton.hide();pinchState=true;scrollState=true;if(watch_timer==null){watch_timer=setInterval(function(){watch_scrollTop()},1e3)}storage=$(this).scrollTop()});function watch_scrollTop(){var _devied=$.os.ios?"ios":"android";if($body.scrollTop()==storage){buttonPosition({devied:_devied});$amButton.show();pinchState=false;scrollState=false;clearInterval(watch_timer);watch_timer=null}}function buttonPosition(options){var ops=options||{};var condition=false;var currentWidth=$(window).width();var currentHeight=$(window).height();var scale=initWidth/currentWidth;console.log(scale);if(ops.tap){condition=true;if(scale!==1){condition=false}}if(!condition){var currentButtonWidth=initButtonWidth/scale;var currentButtonHeight=initButtonHeight/scale;$amButton.css("width",currentButtonWidth);$amButton.css("height",currentButtonHeight);if(ops.devied=="ios"){$amButton.css("left",$body.scrollLeft()+currentWidth-currentButtonWidth-10);$amButton.css("top",$body.scrollTop()+currentHeight-currentButtonHeight-10)}$amButton.show()}}var currentWidth=$(window).width();var currentHeight=$(window).height();var scale=initWidth/currentWidth;if($.os.ios){$amButton.css("zIndex",1e9);$amButton.css("position","absolute");$amButton.css("left",$body.scrollLeft()+initWidth-initButtonWidth-10);$amButton.css("top",$body.scrollTop()+initHeight-initButtonHeight-10);var pinchState=false;var scrollState=false;$body.bind("touchstart",function(e){if(e.touches.length==2){$amButton.hide();pinchState=true}else if(e.touches.length==1){$amButton.hide();scrollState=true}});$body.bind("touchend",function(e){if(pinchState){setTimeout(function(){buttonPosition();pinchState=false},0)}else if(scrollState){setTimeout(function(){buttonPosition();scrollState=false},300)}else{setTimeout(function(){buttonPosition({tap:true})},0)}})}else{$amButton.css("zIndex",1e9);$amButton.css("position","fixed");$amButton.css("right","10px");$amButton.css("bottom","10px");var pinchState=false;var scrollState=false;$body.bind("touchstart",function(e){if(e.touches.length==2){$amButton.hide();pinchState=true}});$body.bind("touchmove",function(e){if(pinchState){var width=$(window).width;setTimeout(function(){if($(window).width===width){$body.trigger("touchend")}},500)}});$body.bind("touchend",function(e){if(pinchState){setTimeout(function(){buttonPosition({devied:"android"});pinchState=false},0)}else{setTimeout(function(){buttonPosition({devied:"android",tap:true})},0)}});$body.bind("doubleTap",function(){setTimeout(function(){buttonPosition({devied:"android"})},600)})}}}})(window,document);